# Sesión 2025-12-27

## Resumen

Mejora completa del dashboard Polaris del Shopify NCF Connector.

## Cambios Realizados

### NCF Manager - Nuevos Endpoints
- `/api/shopify/ncfs` - Historial de comprobantes creados
- `/api/shopify/settings` - GET/POST configuración de empresa
- `/api/shopify/usage` - Estadísticas de uso mensual (últimos 6 meses)

### Shopify Connector - Dashboard Mejorado
- **4 Stats Cards** en header: Órdenes, Con NCF, Pendientes, Este mes
- **Tab Órdenes**: Tabla con órdenes de Shopify, botón "Crear NCF"
- **Tab NCFs**: Historial de comprobantes creados
- **Tab Empresa**: Formulario de datos fiscales (nombre, RNC, dirección, teléfono, email)
- **Tab Resumen**: Gráfico de barras de uso mensual + upgrade a Pro

## Commits

### NCF Manager
- `6474a40` - Agrega endpoints Shopify para historial NCFs, settings y uso

### Shopify Connector
- `97a8099` - Mejora dashboard Polaris con 4 tabs completos
- `4da096e` - Actualiza CLAUDE.md con nueva estructura del dashboard

## Pendiente

### Protected Customer Data
La app tiene el scope `read_orders` aprobado en Shopify Partners, pero la tienda `curetfy-2.myshopify.com` necesita **reinstalar la app** para tomar los nuevos permisos.

**Error actual:**
```
ACCESS_DENIED: This app is not approved to access the Order object.
```

**Solución:**
1. Desinstalar app en curetfy-2.myshopify.com/admin/settings/apps
2. Reinstalar desde Shopify Partners
3. Los permisos de Protected Customer Data se activarán

## Archivos Modificados

### NCF Manager
- `src/app/api/shopify/ncfs/route.ts` (nuevo)
- `src/app/api/shopify/settings/route.ts` (nuevo)
- `src/app/api/shopify/usage/route.ts` (nuevo)

### Shopify Connector
- `app/routes/app._index.tsx` - Dashboard completo reescrito
- `CLAUDE.md` - Documentación actualizada
